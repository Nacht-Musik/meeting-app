#group-page.card
  = form_for group, html: {"dataa-persist" => "garlic"} do |f|
    .card-header
      .form-group
        = f.label 'グループ名'
        = f.text_field :name, class: 'form-control'
    .card-body
      -#所属メンバー表示部
      .form-group
        = f.label '所属メンバー'
        %table#member-table.table.table-sm.table-hover.table-bordered
          %thead.thead-light
            %tr
              %th.text-center{scope: "col"} 名前
              %th.text-center{scope: "col"} メールアドレス
              %th.text-center{scope: "col"} 権限
              %th.text-center{scope: "col"} グループ管理者
              - if mode == "edit" || mode == "new"
                %th.text-center{scope: "col"} 編集
                %th.text-center{scope: "col"} 削除
          %tbody#member-list-area
            = f.fields_for :group_members do |member|
              = render partial: "groups/member_view", locals: {f: member, mode: mode}

        #member-params-area
          - if mode == "edit" || mode == "new"
            = f.fields_for :group_members do |member|
              = render partial: "groups/member_params", locals: {f: member}


      - if mode == "edit" || mode == "new"
        %button.btn.btn-info{"data-target" => "#member-add-modal", "data-toggle" => "modal", :type => "button"}
          = icon('fas' ,'user-plus')
          = "メンバーを追加する"
        %br
        #member-add-modal.modal.fade{"aria-hidden" => "true", "aria-labelledby" => "exampleModalCenterTitle", :role => "dialog", :tabindex => "-1"}
          .modal-dialog.modal-dialog-centered{:role => "document"}
            .modal-content
              .modal-header
                %h5#exampleModalLongTitle.modal-title
                  メンバー追加フォーム
                %button.close{"aria-label" => "Close", "data-dismiss" => "modal", :type => "button"}
                  %span{"aria-hidden" => "true"} ×
              .modal-body
                .form-group
                  = f.label '名前（メールアドレス）'
                  %select#member-selector.custom-select
                    - users.each do |user|
                      %option{value: "#{user.id}",
                              data: {last_name: user.last_name, first_name: user.first_name,
                                      email: user.email} }
                        = "#{user.last_name} #{user.first_name} （ #{user.email} ）"
                .form-group
                  = f.label '権限'
                  %select#authority-selector.custom-select
                    - authorities.each do |authority|
                      %option{value: "#{authority.id}"}
                        = "#{authority.name}"
                .form-group
                  = f.label 'グループ管理者'
                  %select#admin-selector.custom-select{data: {mark: "<i class=\"fas fa-check\">"}}
                    %option{value: 0, selected: "true"} -
                    %option{value: 1} 管理者

              .modal-footer
                %button.btn.btn-secondary{"data-dismiss" => "modal", :type => "button"} Close
                #member-add-btn.btn.btn-info{"data-dismiss" => "modal"}
                  = "このユーザを追加"
                  = icon('fas' ,'user-plus')

          #member-block-template
            .member-params
              %input{type: "hidden", class: 'member-destroy-flag'}
              %input{type: "hidden", class: 'member-user-id'}
              %input{type: "hidden", class: 'member-authority-flag'}
              %input{type: "hidden", class: 'member-admin-flag'}
            %table
              %tbody
                %tr.member-row
                  %td.user-name.text-center
                  %td.user-email.text-center
                  %td.user-authority.text-center
                  %td.user-admin.text-center
                  %td.member-edit.text-center
                    .member-edit-btn.btn.btn-outline-success
                      = icon('fas' ,'user-edit')
                  %td.member-delete.text-center
                    .member-del-btn.btn.btn-outline-danger
                      = icon('fas' ,'user-minus')
        = f.submit class: 'btn btn-primary', id: 'meeting-submit-btn'

- if mode == "edit" || mode == "new"
  :javascript
    initializationMemberSelector();

